<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced One Factor Analysis Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/picocss/1.5.0/pico.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        body > main {
            padding-top: 0;
        }
      nav {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}
        .content-wrapper {
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }
        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <nav class="container-fluid">
        <ul>
            <li><strong>One Factor Analysis Tool</strong></li>
        </ul>
        <ul>
            <li><a href="#tool">Tool</a></li>
            <li><a href="#examples">Examples</a></li>
            <li><a href="#description">Description</a></li>
        </ul>
    </nav>

    <main class="container">
        <div class="content-wrapper">
            <section id="tool">
                <h2>Analysis Tool</h2>
                <form>
                    <div class="grid">
                        <label for="numTreatments">
                            Number of Treatments:
                            <input type="number" id="numTreatments" name="numTreatments" value="3" min="2" required>
                        </label>
                        <label for="numReplications">
                            Number of Replications:
                            <input type="number" id="numReplications" name="numReplications" value="4" min="2" required>
                        </label>
                    </div>
                    <div class="grid">
                        <label for="numSets">
                            Number of Sets:
                            <input type="number" id="numSets" name="numSets" value="1" min="1" required>
                        </label>
                        <label for="design">
                            Select Design:
                            <select id="design" name="design" required>
                                <option value="CRD">Completely Randomized Design (CRD)</option>
                                <option value="RBD">Randomized Complete Block Design (RBD)</option>
                            </select>
                        </label>
                    </div>
                    <label for="transformation">
                        Transformation:
                        <select id="transformation" name="transformation" required>
                            <option value="none">No Transformation</option>
                            <option value="square_root">Square Root</option>
                            <option value="angular">Angular</option>
                        </select>
                    </label>
                    <label for="dataInput">
                        Enter Data (space or tab separated):
                        <textarea id="dataInput" name="dataInput" rows="6" required>123 123 131 133
142 149 147 134
147 172 143 139</textarea>
                    </label>
                    <div class="grid">
                        <label for="importData">
                            Import Data:
                            <input type="file" id="importData" accept=".txt" onchange="importData(event)">
                        </label>
                        <button type="button" onclick="exportData()">Export Data</button>
                    </div>
                    <button type="button" onclick="analyzeData()">Analyze Data</button>
                </form>
            </section>

            <section id="results"></section>

            <section id="examples">
                <h2>Examples</h2>
                <article>
                    <h3>Example 1: Crop Yield Study (CRD)</h3>
                    <p>A researcher wants to compare the yield of three different corn varieties (A, B, C) using a Completely Randomized Design with four replications.</p>
                    <pre><code>123 123 131 133  # Variety A
142 149 147 134  # Variety B  
147 172 143 139  # Variety C</code></pre>
                    <button onclick="loadExample(1)">Load Example 1</button>
                </article>
                <article>
                    <h3>Example 2: Fertilizer Effect Study (RBD)</h3>
                    <p>An agronomist is studying the effect of three fertilizer treatments (A, B, C) on tomato plant height using a Randomized Complete Block Design with four blocks.</p>
                    <pre><code>25.0 23.0 24.3 26.5  # Treatment A
28.5 24.9 27.3 29.2  # Treatment B
41.3 42.5 41.3 46.5  # Treatment C</code></pre>
                    <button onclick="loadExample(2)">Load Example 2</button>
                </article>
            </section>

            <section id="description">
                <h2>Description</h2>
                <p>
                    The One Factor Analysis Tool is designed to perform statistical analysis on experimental data with a single factor (treatment) and multiple replications. It supports both Completely Randomized Design (CRD) and Randomized Complete Block Design (RBD).
                </p>
                <h3>Key Features:</h3>
                <ul>
                    <li>Flexible input for multiple treatments and replications</li>
                    <li>Support for CRD and RBD designs</li>
                    <li>Optional data transformations (Square Root and Angular)</li>
                    <li>Calculation of ANOVA table</li>
                    <li>Post-hoc analysis using Tukey's HSD test</li>
                    <li>Visualization of results using bar charts, box plots, and scatter plots</li>
                    <li>Import and export data functionality</li>
                </ul>
                <p>
                    This tool calculates the Sum of Squares (SS), Degrees of Freedom (DF), Mean Squares (MS), and F-value for treatments, blocks (in RBD), and error. It also provides the grand mean and individual treatment means.
                </p>
                <p>
                    Use this tool to analyze your experimental data and draw conclusions about the significance of treatment effects in your study.
                </p>
            </section>
        </div>
    </main>

    <script>
        function analyzeData() {
            const numTreatments = parseInt(document.getElementById('numTreatments').value);
            const numReplications = parseInt(document.getElementById('numReplications').value);
            const numSets = parseInt(document.getElementById('numSets').value);
            const design = document.getElementById('design').value;
            const transformation = document.getElementById('transformation').value;
            const dataInput = document.getElementById('dataInput').value;

            // Parse the input data
            const data = dataInput.trim().split('\n').map(row => row.trim().split(/\s+/).map(Number));

            // Validate input data
            if (data.length !== numTreatments * numSets) {
                alert(`Error: Expected ${numTreatments * numSets} rows of data, but got ${data.length}.`);
                return;
            }
            if (data.some(row => row.length !== numReplications)) {
                alert(`Error: Each row should have ${numReplications} values.`);
                return;
            }

            // Perform the analysis for each set
            let allResults = '';
            for (let set = 0; set < numSets; set++) {
                const setData = data.slice(set * numTreatments, (set + 1) * numTreatments);
                const results = performAnalysis(setData, numTreatments, numReplications, design, transformation);
                allResults += `<article><h3>Analysis for Set ${set + 1}</h3>${results}</article>`;
            }

            // Display the results
            document.getElementById('results').innerHTML = allResults;

            // Add download button
            const downloadBtn = document.createElement('button');
            downloadBtn.textContent = 'Download Results';
            downloadBtn.onclick = () => downloadResults(allResults);
            document.getElementById('results').appendChild(downloadBtn);
        }

        function performAnalysis(data, numTreatments, numReplications, design, transformation) {
            // Apply transformation if needed
            if (transformation !== 'none') {
                data = data.map(row => row.map(val => transformValue(val, transformation)));
            }

            // Calculate basic statistics
            const grandTotal = data.flat().reduce((sum, val) => sum + val, 0);
            const grandMean = grandTotal / (numTreatments * numReplications);
            const treatmentTotals = data.map(row => row.reduce((sum, val) => sum + val, 0));
            const treatmentMeans = treatmentTotals.map(total => total / numReplications);

            // Calculate Sum of Squares
            const totalSS = data.flat().reduce((sum, val) => sum + Math.pow(val - grandMean, 2), 0);
            const treatmentSS = treatmentTotals.reduce((sum, total) => sum + Math.pow(total / numReplications - grandMean, 2), 0) * numReplications;

            let blockSS = 0;
            if (design === 'RBD') {
                const blockTotals = Array(numReplications).fill(0);
                for (let i = 0; i < numTreatments; i++) {
                    for (let j = 0; j < numReplications; j++) {
                        blockTotals[j] += data[i][j];
                    }
                }
                blockSS = blockTotals.reduce((sum, total) => sum + Math.pow(total / numTreatments - grandMean, 2), 0) * numTreatments;
            }

            const errorSS = totalSS - treatmentSS - blockSS;

            // Calculate Degrees of Freedom
            const totalDF = numTreatments * numReplications - 1;
            const treatmentDF = numTreatments - 1;
            const blockDF = design === 'RBD' ? numReplications - 1 : 0;
            const errorDF = totalDF - treatmentDF - blockDF;

            // Calculate Mean Squares
            const treatmentMS = treatmentSS / treatmentDF;
            const blockMS = blockSS / blockDF;
            const errorMS = errorSS / errorDF;

            // Calculate F-value
            const fValue = treatmentMS / errorMS;

            // Prepare results HTML
            let resultsHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Source of Variation</th>
                            <th>DF</th>
                            <th>SS</th>
                            <th>MS</th>
                            <th>F-value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Treatments</td>
                            <td>${treatmentDF}</td>
                            <td>${treatmentSS.toFixed(2)}</td>
                            <td>${treatmentMS.toFixed(2)}</td>
                            <td>${fValue.toFixed(2)}</td>
                        </tr>
            `;

            if (design === 'RBD') {
                resultsHTML += `
                    <tr>
                        <td>Blocks</td>
                        <td>${blockDF}</td>
                        <td>${blockSS.toFixed(2)}</td>
                        <td>${blockMS.toFixed(2)}</td>
                        <td>-</td>
                    </tr>
                `;
            }

            resultsHTML += `
                        <tr>
                            <td>Error</td>
                            <td>${errorDF}</td>
                            <td>${errorSS.toFixed(2)}</td>
                            <td>${errorMS.toFixed(2)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Total</td>
                            <td>${totalDF}</td>
                            <td>${totalSS.toFixed(2)}</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
                <p>Grand Mean: ${grandMean.toFixed(2)}</p>
                <h4>Treatment Means:</h4>
                <ul>
                    ${treatmentMeans.map((mean, i) => `<li>Treatment ${String.fromCharCode(65 + i)}: ${mean.toFixed(2)}</li>`).join('')}
                </ul>
            `;

            // Add Tukey's HSD test results
            const tukeyResults = performTukeyHSD(data, treatmentMeans, errorMS, numReplications);
            resultsHTML += `
                <h4>Tukey's HSD Test:</h4>
                <p>HSD: ${tukeyResults.HSD.toFixed(2)}</p>
                <table>
                    <thead>
                        <tr>
                            <th>Comparison</th>
                            <th>Difference</th>
                            <th>Significant</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tukeyResults.comparisons.map(comp => `
                            <tr>
                                <td>${comp.pair}</td>
                                <td>${comp.difference}</td>
                                <td>${comp.significant ? 'Yes' : 'No'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            // Add visualizations
            resultsHTML += `
                <h4>Visualizations:</h4>
                <div class="grid">
                    <div>
                        <canvas id="treatmentMeansChart"></canvas>
                    </div>
                    <div>
                        <canvas id="boxPlotChart"></canvas>
                    </div>
                    <div>
                        <canvas id="scatterPlotChart"></canvas>
                    </div>
                </div>
            `;

            // Create charts after a short delay to ensure the canvas elements are ready
            setTimeout(() => {
                createTreatmentMeansChart(treatmentMeans);
                createBoxPlotChart(data);
                createScatterPlot(data);
            }, 100);

            return resultsHTML;
        }

        function transformValue(value, transformation) {
            switch (transformation) {
                case 'square_root':
                    return Math.sqrt(value);
                case 'angular':
                    return Math.asin(Math.sqrt(value / 100)) * (180 / Math.PI);
                default:
                    return value;
            }
        }

        function performTukeyHSD(data, treatmentMeans, errorMS, numReplications) {
            const q = 4.33; // q value for 3 treatments, 9 degrees of freedom at 0.05 significance
            const HSD = q * Math.sqrt(errorMS / numReplications);

            let comparisons = [];
            for (let i = 0; i < treatmentMeans.length; i++) {
                for (let j = i + 1; j < treatmentMeans.length; j++) {
                    const diff = Math.abs(treatmentMeans[i] - treatmentMeans[j]);
                    const significant = diff > HSD;
                    comparisons.push({
pair: ${String.fromCharCode(65 + i)} - ${String.fromCharCode(65 + j)},
difference: diff.toFixed(2),
significant: significant
});
}
}
      return { HSD, comparisons };
    }

    function downloadResults(results) {
        const blob = new Blob([results.replace(/<[^>]+>/g, '')], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'one_factor_analysis_results.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function createTreatmentMeansChart(treatmentMeans) {
        const ctx = document.getElementById('treatmentMeansChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: treatmentMeans.map((_, i) => `Treatment ${String.fromCharCode(65 + i)}`),
                datasets: [{
                    label: 'Treatment Means',
                    data: treatmentMeans,
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Treatment Means Comparison'
                    },
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function createBoxPlotChart(data) {
        const ctx = document.getElementById('boxPlotChart').getContext('2d');

        const boxplotData = data.map((treatment, i) => {
            const sorted = treatment.sort((a, b) => a - b);
            const q1 = sorted[Math.floor(sorted.length / 4)];
            const median = sorted[Math.floor(sorted.length / 2)];
            const q3 = sorted[Math.floor(3 * sorted.length / 4)];
            const min = sorted[0];
            const max = sorted[sorted.length - 1];

            return {
                label: `Treatment ${String.fromCharCode(65 + i)}`,
                data: [
                    { x: String.fromCharCode(65 + i), y: [min, q1, median, q3, max] }
                ],
                backgroundColor: `hsla(${i * 360 / data.length}, 70%, 50%, 0.5)`,
                borderColor: `hsla(${i * 360 / data.length}, 70%, 50%, 1)`,
                borderWidth: 1
            };
        });

        new Chart(ctx, {
            type: 'boxplot',
            data: {
                datasets: boxplotData
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Box Plot of Treatments'
                    },
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    function createScatterPlot(data) {
        const ctx = document.getElementById('scatterPlotChart').getContext('2d');
        const datasets = data.map((treatment, i) => ({
            label: `Treatment ${String.fromCharCode(65 + i)}`,
            data: treatment.map((value, j) => ({ x: j + 1, y: value })),
            backgroundColor: `hsla(${i * 360 / data.length}, 70%, 50%, 0.7)`,
        }));

        new Chart(ctx, {
            type: 'scatter',
            data: { datasets },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Scatter Plot of Treatments' },
                },
                scales: {
                    x: { title: { display: true, text: 'Replication' } },
                    y: { title: { display: true, text: 'Value' } },
                }
            }
        });
    }

    function importData(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('dataInput').value = e.target.result;
        };
        reader.readAsText(file);
    }

    function exportData() {
        const data = document.getElementById('dataInput').value;
        const blob = new Blob([data], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'experiment_data.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function loadExample(exampleNumber) {
        const numTreatmentsInput = document.getElementById('numTreatments');
        const numReplicationsInput = document.getElementById('numReplications');
        const numSetsInput = document.getElementById('numSets');
        const designInput = document.getElementById('design');
        const dataInput = document.getElementById('dataInput');

        if (exampleNumber === 1) {
            numTreatmentsInput.value = 3;
            numReplicationsInput.value = 4;
            numSetsInput.value = 1;
            designInput.value = 'CRD';
            dataInput.value = `123 123 131 133
142 149 147 134
147 172 143 139;             } else if (exampleNumber === 2) {                 numTreatmentsInput.value = 3;                 numReplicationsInput.value = 4;                 numSetsInput.value = 1;                 designInput.value = 'RBD';                 dataInput.value = 25.0 23.0 24.3 26.5
28.5 24.9 27.3 29.2
41.3 42.5 41.3 46.5`;
}
}
</script>
</body>
</html>
